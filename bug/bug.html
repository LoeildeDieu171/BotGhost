<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Signaler un bug</title>
  <link rel="stylesheet" href="bug.css">
</head>
<body>

<div class="modal-overlay active">
  <div class="modal">
    <!-- Modal Header -->
    <div class="modal-header">
      <div class="modal-title-section">
        <span class="bug-icon">üêû</span>
        <div>
          <h2>Signaler un bug</h2>
          <p>Aidez-nous √† am√©liorer le site</p>
        </div>
      </div>
      <button class="close-btn" onclick="closeBugReport()">&times;</button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      <form id="bugForm" onsubmit="submitBug(event)">
        
        <!-- Nouveau rapport -->
        <div class="form-section">
          <h3>üìã Nouveau rapport</h3>
          
          <!-- Titre du bug -->
          <div class="form-group">
            <label>Titre du bug <span class="required">*</span></label>
            <input 
              type="text" 
              name="title"
              placeholder="Ex: Le bouton de connexion ne fonctionne pas" 
              required
            >
          </div>

          <!-- Description -->
          <div class="form-group">
            <label>Description d√©taill√©e <span class="required">*</span></label>
            <textarea 
              name="description"
              placeholder="D√©crivez le bug en d√©tail : ce que vous faisiez, ce qui s'est pass√©, ce que vous attendiez..." 
              required
              minlength="20"
            ></textarea>
            <small>Minimum 20 caract√®res</small>
          </div>

          <!-- Page concern√©e -->
          <div class="form-group">
            <label>Page concern√©e</label>
            <input 
              type="text" 
              name="page"
              placeholder="/dashboard/bug" 
              value="/page-principal"
            >
          </div>

          <!-- Priorit√© -->
          <div class="form-group">
            <label>Priorit√© estim√©e</label>
            <div class="priority-options">
              <label class="priority-option">
                <input type="radio" name="priority" value="Faible">
                <div class="priority-label">
                  <strong>Faible</strong>
                  <small>Probl√®me mineur, n'affecte pas l'utilisation</small>
                </div>
              </label>
              <label class="priority-option active">
                <input type="radio" name="priority" value="Moyen" checked>
                <div class="priority-label">
                  <strong>Moyen</strong>
                  <small>Probl√®me g√™nant mais confortable</small>
                </div>
              </label>
              <label class="priority-option">
                <input type="radio" name="priority" value="√âlev√©">
                <div class="priority-label">
                  <strong>√âlev√©</strong>
                  <small>Probl√®me bloquant certaines fonctionnalit√©s</small>
                </div>
              </label>
              <label class="priority-option">
                <input type="radio" name="priority" value="Critique">
                <div class="priority-label">
                  <strong>Critique</strong>
                  <small>Site inutilisable ou donn√©es perdues</small>
                </div>
              </label>
            </div>
          </div>
        </div>

        <!-- Conseils -->
        <div class="tips-section">
          <div class="tips-icon">‚ÑπÔ∏è</div>
          <div>
            <h4>Conseils pour un bon rapport</h4>
            <ul>
              <li>D√©crivez les √©tapes pour reproduire le bug</li>
              <li>Indiquez ce que vous attendiez vs ce qui s'est pass√©</li>
              <li>Mentionnez si le bug est reproductible ou al√©atoire</li>
            </ul>
          </div>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="submit-btn">
          ‚ö†Ô∏è Envoyer le rapport
        </button>
      </form>
    </div>
  </div>
</div>

<script>
  function closeBugReport() {
    window.location.href = '/page-principal/html/accueil.html';
  }

  function submitBug(event) {
    event.preventDefault();
    
    const formData = new FormData(event.target);
    const bugData = {
      title: formData.get('title') || '',
      description: formData.get('description') || '',
      page: formData.get('page') || '',
      priority: formData.get('priority') || 'Moyen'
    };

    fetch('/api/report-bug', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(bugData)
    })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('Merci! Votre rapport a √©t√© envoy√© avec succ√®s.');
          closeBugReport();
        } else {
          alert('Erreur: ' + (data.message || 'Impossible d\'envoyer le rapport'));
        }
      })
      .catch(err => {
        console.error('Erreur:', err);
        alert('Erreur lors de l\'envoi du rapport');
      });
  }
</script>

</body>
</html>
